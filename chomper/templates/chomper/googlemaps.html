<!DOCTYPE html>
<html>
    {% include 'chomper/base.html' %}
	{% load leaflet_tags %}
	{% load geojson_tags %}
    <style>
	  .leaflet-container {  /* all maps */
        width:  800px;
        height: 500px;
		  margin: 0 auto;
    }
		.dropdown {
		max-width: 550px;
        padding: 15px;
        margin: 0 auto;
    }
		body {
    	background-color: #48B8D2;
	}
    </style>


	<head>
		{% leaflet_js %}
		{% leaflet_css %}
	</head>

    <body>
        <script>
            $(document).ready(function() {
                $("select").select2();
            });
        </script>

		<section class="row">
			{% if datum %}
				<div class="panel panel-default">
					<div class="panel-body">
					<div class="col-sm-3 col-md-3 text-center"></div>
                    <div class="col-sm-9 col-md-9 text-center">
						You are viewing {{ datum.numrest }} {{ datum.cuisine }} restaurants between {{ datum.origin }} and {{ datum.destination }} .
                    <br>
                        Traveling via {{ datum.mode }} , you are about {{ datum.duration }} away from this point.
                    <br>

					</div>
					</div>
				</div>
			{% endif %}

		</section>
    {% if data %}
    {% else %}
	  <section class="row">
		  <div class="container">
			  <form class="form-google" id="google_form" method="post" action="/chomper/googlemaps/">
          			{% csrf_token %}
          			{% load bootstrap %}

				  <div class="col-sm-6">

					  <div class="col-xs-12 text-center">
						  <h3>Enter Locations</h3>
					  </div>

                      <div class="panel panel-default">
                        <div class="panel-body">

                            <div class="col-xs-12 text-center">
                                <input type="text" name="origin" class="form-control" placeholder="Enter an origin" value="" required autofocus>
                                <input type="text" name="destination" class="form-control" placeholder="Enter a destination" value="" required autofocus>

                                <div class="btn-group text-center" data-toggle="buttons">
                                    <label class="btn btn-default">
                                        <input type="radio" id="q156" name="mode" value="driving" /> Driving
                                    </label>
                                    <label class="btn btn-default">
                                        <input type="radio" id="q157" name="mode" value="transit" /> Transit
                                    </label>
                                    <label class="btn btn-default">
                                        <input type="radio" id="q158" name="mode" value="walking" checked="checked" /> Walking
                                    </label>
                                </div>
						</div>


                    </div>
                    </div>

			  		</div>

				  <div class="col-sm-6">

					  <div class="col-xs-12 text-center">
						  <h3>Select Restaurant Category</h3>
					  </div>

					<div class="panel panel-default">
                    <div class="panel-body">
                        <div class="col-sm-12 col-md-12 text-center">
                            <select name="cuisine" style="width: 100%">
                                <option selected="selected" disabled>Select a cuisine</option>
                                <option value="BBQ">BBQ</option>
                                <option value="Italian / Pizza">Italian / Pizza</option>
                                <option data-divider="true">------</option>
                                <option value="American">American</option>
                                <option value="Southern">Southern</option>
                                <option value="Steakhouse">Steakhouse</option>
                                <option value="Fast Food">Fast Food</option>
                                <option value="Diner / Breakfast">Diner / Breakfast</option>
                                <option value="Casual">Casual</option>
                                <option value="Seafood">Seafood</option>
                                <option value="Vegetarian">Vegetarian</option>
                                <option data-divider="true"></option>
                                <option value="Caribbean">Caribbean</option>
                                <option value="Latin American">Latin American</option>
                                <option value="Mexican">Mexican</option>
                                <option data-divider="true"></option>
                                <option value="Thai">Thai</option>
                                <option value="Chinese">Chinese</option>
                                <option value="Indian">Indian</option>
                                <option value="Vietnamese">Vietnamese</option>
                                <option value="Japanese / Sushi">Japanese / Sushi</option>
                                <option data-divider="true"></option>
                                <option value="African">African</option>
                                <option value="Spanish / Tapas">Spanish / Tapas</option>
                                <option value="Mediterranean">Mediterranean</option>
                                <option value="Greek">Greek</option>
                                <option value="French / Belgian">French / Belgian</option>
                                <option value="Pub">Pub</option>
                            </select>
                        </div>

						<div class="col-xs-12 text-center">
                            <br>
                            <label>Search Radius</label>
							<div class="btn-group" data-toggle="buttons">
								<label class="btn btn-default">
									<input type="radio" name="radius" value="1" checked="checked" /> 1 mi.
								</label>
								<label class="btn btn-default">
									<input type="radio" name="radius" value="2" /> 2 mi.
								</label>
								<label class="btn btn-default">
									<input type="radio" name="radius" value="5" /> 5 mi.
								</label>
							</div>
						</div>

						<div class="col-xs-12 text-center">
							<div class="checkbox">
								<label><input type="checkbox" value="">Only show 'Open Now'?</label>
							</div>
						</div>

{#				  <button class="btn btn-lg btn-primary btn-block" type="submit">Search</button>#}
{#				  <input type="hidden" name="submit" value="submit" />#}
                </div>
                </div>
              </div>
              <button class="btn btn-lg btn-primary btn-block" type="submit">Search</button>
              <input type="hidden" name="submit" value="submit" />
              </div>
			  </form>
		  </div>
	  </section>
        {% endif %}

        {% if data %}
        <section>
        <div class="col-xs-4">
            <br>
            <div class="table-responsive">
	            <table data-toggle="table" class="table table-bordered table-hover table-striped tablesorter sortable">
	                <thead>
	                <tr>
	                <th class="header"> Name <i class="icon-sort"></i></th>
					<th class="header" data-sortable="true"> Rating <i class="icon-sort"></i></th>
                    <th class="header"> Cuisine <i class="icon-sort"></i></th>
                    <th class="header" data-sortable="true"> Extra Route Time <i class="icon-sort"></i></th>
	                </tr>
	            </thead>
	            <tbody>
					{% for key in data %}
					<tr>
	                    <td>
                            <a target="_blank" href= {{ key.url }}>
                            <div style="height:100%;width:100%">
                                {{ key.name }}
                            </div>
                            </a>
                        </td>
	                    <td>{{ key.rating }}</td>
                        <td>{{ key.cuisine.0.0 }}</td>
                        <td>{{ key.outofthewaytime }}</td>
	    			</tr>
	            	{% endfor %}
	            </tbody>
	            </table>
	        </div>
        </div>
        <div class="col-sm-8">

        {% leaflet_map "spots" callback="map_init" %}
        </div>
        </section>

        {% else %}
        <section>
        <div class="col-sm-12">
        {% leaflet_map "spots" callback="map_init" %}
        </div>
        </section>
        {% endif %}

		<script type="text/javascript">
        if (navigator.geolocation) { // device can return its location
        navigator.geolocation.getCurrentPosition(function(position) {
             console.log(position.coords.latitude);
             console.log(position.coords.longitude);
        })
        }
		// IE9 fix
		if(!window.console) {
			var console = {
				log : function(){},
				warn : function(){},
				error : function(){},
				time : function(){},
				timeEnd : function(){}
			}
			}

            $(function(){
              $('.js-popup-link').click(function(e){
                e.preventDefault()
                $('#popup').dialog({modal: true}).dialog('open').load(this.href)
              })
            })

			function onEachFeature(feature, layer) {
    			if (feature.properties && feature.properties.popupContent) {
					console.log(5 + 6);
      				layer.bindPopup(feature.properties.popupContent);
    				}
			}


			function map_init (map, options) {

				var dataurl = '{% url "data" %}';
				// Download GeoJSON via Ajax
				$.getJSON(dataurl, function (data) {
					// Add GeoJSON layer
					L.geoJson(data).addTo(map);
				});

				var datapointsurl = '{% url "datapoints" %}';
				// Download GeoJSON via Ajax
				$.getJSON(datapointsurl, function (data) {
					// Add GeoJSON layer

{#					L.geoJson(data, {onEachFeature: onEachFeature}).addTo(map);#}


{#                    L.geoJson(data, {#}
{#                        pointToLayer: function(feature, latlng) {#}
{#                            return L.marker(latlng, {icon: redIcon});#}
{#                        },#}
{#                        onEachFeature: onEachFeature#}
{#                    }).addTo(map);#}

                    L.geoJson(data, {
                        pointToLayer: function(feature, latlng) {
                            return L.marker(latlng, {
                                icon: L.icon({
                                    iconUrl: 'https://cdn.rawgit.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-' + feature.properties.Color + '.png',
                                    shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.3/images/marker-shadow.png',
                                    iconSize: [25, 41],
                                    iconAnchor: [12, 41],
                                    popupAnchor: [1, -34],
                                    shadowSize: [41, 41]
                                })
                            });
                        },
                        onEachFeature: onEachFeature
                    }).addTo(map);

                    map.fitBounds(L.geoJson(data).getBounds());
				});

			}
		</script>
{#      	{% if data %}#}
{#	      <div class="col-lg-12">#}
{#	        <div class="table-responsive">#}
{#	            <table class="table table-bordered table-hover table-striped tablesorter">#}
{#	                <thead>#}
{#	                <tr>#}
{#	                <th class="header"> Name <i class="icon-sort"></i></th>#}
{#					<th class="header"> Rating <i class="icon-sort"></i></th>#}
{#	                <th class="header"> Address <i class="icon-sort"></i></th>#}
{#	                <th class="header"> Cuisine <i class="icon-sort"></i></th>#}
{#                    <th class="header"> Neighborhood <i class="icon-sort"></i></th>#}
{#                    <th class="header"> Origin Time <i class="icon-sort"></i></th>#}
{#                    <th class="header"> Destination Time <i class="icon-sort"></i></th>#}
{#                    <th class="header"> Out of the Way Time <i class="icon-sort"></i></th>#}
{#					<th class="header"> URL <i class="icon-sort"></i></th>#}
{#	                </tr>#}
{#	            </thead>#}
{#	            <tbody>#}
{#					{% for key in data %}#}
{#					<tr>#}
{#	                    <td>{{ key.name }}</td>#}
{#	                    <td>{{ key.rating }}</td>#}
{#	                    <td>{{ key.address }}</td>#}
{#	                    <td>{{ key.cuisine.0.0 }}</td>#}
{#						<td>{{ key.neighborhood }}</td>#}
{#                        <td>{{ key.origintime }}</td>#}
{#                        <td>{{ key.destinationtime }}</td>#}
{#                        <td>{{ key.outofthewaytime }}</td>#}
{#	                    <td>{{ key.url |urlize }}</td>#}
{#	    			</tr>#}
{#	            	{% endfor %}#}
{#	            </tbody>#}
{#	            </table>#}
{#	        </div>#}
{#	      </div>#}
{##}
{#	    {% endif %}#}

    </body>
</html>